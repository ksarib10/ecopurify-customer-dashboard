<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EcoPurify | Customer Dashboard</title>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image.jpg" href="{{ url_for('static', filename='images/image.jpg') }}">

  <!-- Main CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <h3 class="sidebar-title">My Plants</h3>

    <ul class="plant-list">
      {% for plant in plants %}
        <li
          class="plant-item {% if plant.plant_id == session.active_plant_id %}active{% endif %}"
          data-plant-id="{{ plant.plant_id }}"
        >
          {{ plant.plant_name }}
        </li>
      {% endfor %}
    </ul>

  </div>

  <!-- Overlay -->
  <div id="overlay" class="overlay"></div>


  <div class="dashboard">

    <header class="dashboard-header">
      <!-- LEFT -->
      <div class="header-left">
        <div class="hamburger" id="hamburger"><b>&#9776;</b></div>
        <img src="{{ url_for('static', filename='images/image.jpg') }}" class="logo" />
      </div>

      <!-- CENTER -->
      <div class="header-center">
        <h1 class="dashboard-title">Customer Dashboard</h1>
      </div>

      <!-- RIGHT -->
      <div class="header-right">
        <a href="/refresh" class="btn-refresh">Refresh Data</a>
        <a href="/logout" class="logout-btn">Logout</a>
      </div>
    </header>
 

    <section>
      <div class="card">

        <h4 class="live-time">
          <span id="clock">--:--:-- --</span>
          <span class="live-badge">LIVE</span>
        </h4>

        <p class="service-info">
          Last serviced: <strong>{{ plant.last_service_date }}</strong>
          · {{ days_passed }} days ago
          · <span class="risk-text">Service risk approaching</span>
        </p>

      </div>
    </section>
    <!-- SUMMARY CARDS -->
    <section class="cards">

      <div class="card">
        <h4>Customer Name</h4>
        <p>{{ plant.customer_name }}</p>
      </div>

      <div class="card">
        <h4>Model</h4>
        <p>{{ plant.model }}</p>
      </div>

      <div class="card">
        <h4>City</h4>
        <p>{{ plant.city }}</p>
      </div>

      <div class="card">
        <h4>UV Status</h4>
        <p
          class="{% if plant.uv_status == 'Active' %}status-green{% else %}status-red{% endif %}">
          {{ plant.uv_status }}
        </p>
      </div>

      <div class="card">
        <h4>Deployment Date</h4>
        <p>{{ plant.deployment_date }}</p>
      </div>

    </section>

    <!-- TECHNICAL DETAILS -->
    <section class="cards">

      <div class="card">
        <h4>Installation Cost</h4>
        <p>PKR {{ plant.installation_cost }}</p>
      </div>

      <div class="card">
        <h4>Monthly Service Charges</h4>
        <p>PKR {{ plant.monthly_service_charges }}</p>
      </div>

      <div class="card">
        <h4>Input Water TDS</h4>
        <p>{{ plant.input_tds_ppm }}</p>
      </div>

      <div class="card">
        <h4>Output Water TDS</h4>
        <p>{{ plant.output_tds_ppm }}</p>
      </div>

      <div class="card">
        <h4>System Capacity</h4>
        <p>{{ plant.size_gpd }} GPD</p>
      </div>

    </section>

    <!-- PERFORMANCE SECTION -->
    <section class="performance">

      <!-- RO Efficiency -->
      <div class="performance-card">
        <h3 class="card-title">
          RO Performance Efficiency
          <span class="blink-group {{ plant.health_ro|lower|replace(' ', '-') }}">
            <span class="blink-dot"></span>
            <span class="blink-dot"></span>
            <span class="blink-dot"></span>
          </span>
        </h3>

        <div class="efficiency-value">
          {{ plant.health_ro }}
        </div>

        <div class="progress-bar">
          <div class="progress-fill {{ plant.health_ro
            |lower
            |replace(' ', '-')
            |replace('_', '-')
            }}"></div>
        </div>

        <p class="muted-text">
          Output: {{ plant.output_tds_ppm }} PPM
        </p>
      </div>

      <!-- Filter Health -->
      <div class="performance-card">
        <h3 class="card-title">
          Filter Health Overview
          <span class="blink-group {{ plant.health_ro|lower|replace(' ', '-') }}">
            <span class="blink-dot"></span>
            <span class="blink-dot"></span>
            <span class="blink-dot"></span>
          </span>
        </h3>
        <!-- PP -->
        <div class="health-row">
          <span>PP Filter</span>
          <div class="progress-bar">
            <div class="progress-fill {{ plant.health_pp |lower |replace(' ', '-') }}"></div>
          </div>
          
          <span class="health-label {{ plant.health_pp |lower |replace(' ', '-') }}">
            {{ plant.health_pp }}
          </span>
          
        </div>

        <!-- CTO -->
        <div class="health-row">
          <span>CTO Filter</span>
          <div class="progress-bar">
            <div class="progress-fill {{ plant.health_cto |lower |replace(' ', '-') }}"></div>
          </div>
        
          <span class="health-label {{ plant.health_cto |lower |replace(' ', '-') }}">
            {{ plant.health_cto }}
          </span>
        </div>

        <!-- RO -->
        <div class="health-row">
          <span>RO Membrane</span>
          
          <div class="progress-bar">
            <div class="progress-fill {{ plant.health_ro |lower |replace(' ', '-') }}"></div>
          </div>
          <span class="health-label {{ plant.health_ro |lower |replace(' ', '-') }}">
            {{ plant.health_ro }}
          </span>
        </div>

        <!-- Mineral -->
        <div class="health-row">
          <span>Mineralization</span>
          <div class="progress-bar">
            <div class="progress-fill {{ plant.health_mineralization |lower |replace(' ', '-') }}"></div>
          </div>
          <span class="health-label {{ plant.health_mineralization |lower |replace(' ', '-') }}">
            {{ plant.health_mineralization }}
          </span>
        </div>
      </div>

    </section>

  </div>

  <!-- Dashboard Logic -->
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
